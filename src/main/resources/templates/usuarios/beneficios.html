<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
<meta charset="UTF-8">
<title>Mis Beneficios | Reciclaje Inteligente</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">

<style>
body {
	background-color: #f8f9fa;
}

.container {
	margin-top: 50px;
}

h2 {
	color: #198754;
}

.table th {
	background-color: #198754;
	color: white;
}

@media print {
	.no-print {
		display: none;
	}
}
</style>
</head>
<body>
	<div class="container">
		<h2 class="text-center mb-4">🎁 Mis Beneficios Generales</h2>

		<!-- Nav tabs -->
		<ul class="nav nav-tabs mb-4" id="beneficiosTabs" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="disponibles-tab"
					data-bs-toggle="tab" data-bs-target="#disponibles" type="button"
					role="tab" aria-controls="disponibles" aria-selected="true">
					✨ Disponibles</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="reclamados-tab" data-bs-toggle="tab"
					data-bs-target="#reclamados" type="button" role="tab"
					aria-controls="reclamados" aria-selected="false">🎓
					Reclamados</button>
			</li>
		</ul>

		<!-- Tab panes -->
		<div class="tab-content" id="beneficiosTabsContent">

			<!-- Beneficios Disponibles -->
			<div class="tab-pane fade show active" id="disponibles"
				role="tabpanel" aria-labelledby="disponibles-tab">
				<div th:if="${#lists.isEmpty(disponibles)}"
					class="alert alert-info text-center">No hay beneficios
					disponibles por el momento.</div>
				<table class="table table-bordered table-hover"
					th:if="${!#lists.isEmpty(disponibles)}">
					<thead>
						<tr>
							<th>Beneficio</th>
							<th>Categoría</th>
							<th>Descuento</th>
							<th>Acción</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="beneficio : ${disponibles}">
							<td th:text="${beneficio.nombreBeneficio}"></td>
							<td th:text="${beneficio.categoria}"></td>
							<td th:text="${beneficio.porcentaje + '%'}"></td>
							<td>
								<form th:action="@{/usuarios/beneficios/reclamar}" method="post">
									<input type="hidden" name="idDescuento"
										th:value="${beneficio.id}" />
									<button type="submit" class="btn btn-success btn-sm">🎟️
										Reclamar</button>
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<!-- Beneficios Reclamados -->
			<div class="tab-pane fade" id="reclamados" role="tabpanel"
				aria-labelledby="reclamados-tab">
				<div th:if="${#lists.isEmpty(reclamados)}"
					class="alert alert-info text-center">Aún no has reclamado
					beneficios.</div>
				<table class="table table-bordered table-hover"
					th:if="${!#lists.isEmpty(reclamados)}">
					<thead>
						<tr>
							<th>Fecha</th>
							<th>Beneficio</th>
							<th>Categoría</th>
							<th>Descuento</th>
							<th>Código</th>
							<th>Estado</th>
							<th>Acción</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="beneficio : ${reclamados}">
							<td
								th:text="${#temporals.format(beneficio.fechaGeneracion, 'dd/MM/yyyy')}"></td>
							<td th:text="${beneficio.nombreBeneficio}"></td>
							<td th:text="${beneficio.categoria}"></td>
							<td th:text="${beneficio.porcentaje + '%'}"></td>
							<!-- ✅ Aquí va el código único -->
							<td th:text="${beneficio.codigoUnico}"></td>

							<!-- 🟢 Estado: Activo o Usado -->
							<td><span th:text="${beneficio.usado ? 'Usado' : 'Activo'}"
								th:classappend="${beneficio.usado ? 'badge bg-secondary' : 'badge bg-success'}">
							</span></td>

							<!-- 📧 Botón enviar -->
							<td>
								<form th:action="@{/usuarios/tickets/enviar}" method="post">
									<input type="hidden" name="descuentoId"
										th:value="${beneficio.id}" />
									<button type="submit" class="btn btn-primary btn-sm">📧
										Enviar</button>
								</form>
							</td>
						</tr>
					</tbody>

				</table>
			</div>

		</div>

		<!-- Botones finales -->
		<div class="text-center mt-4 no-print">
			<a th:href="@{/usuarios/home}" class="btn btn-secondary">← Volver
				al Dashboard</a>
			<button onclick="window.print()" class="btn btn-success">🖨️
				Imprimir / Guardar PDF</button>
		</div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
